@model CategoryDetailVM
@{
    int con = 1;
}

<div class="container mt-5" method="post">
    <div class="card">
        <div class="card-body mt-5 ml-5 ">
            <div class="row">

                <div class="col-lg-10 col-md-2 col-sm-10 ml-3 mr-3">

                    <div class="d-flex justify-content-center align-items-center">

                        <div class="mr-5">
                            <h3 class="box-title mb-4">@Model.Category.Name</h3>
                            <div class="mr-5 d-flex gap-2">

                            <div class="text-center">
                                <a asp-area="Admin" asp-controller="Category" asp-action="Update" asp-route-id="@Model.Category.Id" class="btn btn-sm btn-warning">Edit</a>
                            </div>
                            <div class="text-center">
                                <a asp-area="Admin" asp-controller="Category" asp-action="SoftDelete" asp-route-id="@Model.Category.Id" class="btn btn-sm btn-danger">Remove</a>
                            </div>
                            </div>
                        </div>

                    </div>

                </div>

                <div class="col-lg-12 col-md-12 col-sm-12">
                    <h3 class="box-title mt-5">General Info</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-product">
                            <tbody>

                                <tr>
                                    <td width="390">Number of Products in a Category</td>
                                    <td>@(Model.Category.ProductCategory != null ? Model.Category.ProductCategory.Count() : 0)</td>
                                </tr>
                                <tr>
                                    <td width="390">Number of Subcategories</td>
                                    <td>@(Model.Category.ChildCategories != null ? Model.Category.ChildCategories.Count() : 0)</td>
                                </tr>
                                <tr>
                                    <td width="390">Creat by</td>
                                    <td>@Model.Category.CreatedBy</td>
                                </tr>
                                <tr>
                                    <td width="390">Created date</td>
                                    <td>@Model.Category.Created</td>
                                </tr>
                                <tr>
                                    <td width="390">Modified by</td>
                                    <td>@Model.Category.ModifiedBy</td>
                                </tr>
                                <tr>
                                    <td width="390">Modified date</td>
                                    <td>@Model.Category.Modified</td>
                                </tr>
                                <tr>
                                    <td width="390">IP Address</td>
                                    <td>@Model.Category.IPAddress</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>



                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <h3 class="box-title mt-5">@(Model.ChildCategories != null && Model.ChildCategories.Count() == 0 ? "Subcategory not found or Deleted" : "Sub List")</h3>

                        <div class="table-responsive">
                            <table class="table table-striped table-product">
                                <tbody>

                                    @if (Model.ChildCategories != null)
                                    {
                                        @foreach (Category sub in Model.ChildCategories)
                                        {
                                            <tr>
                                                <td width="390">@(con++)</td>
                                                <td>@sub.Name</td>
                                                <td>
                                                    <a asp-area="Admin" asp-controller="Category" asp-action="Detail" asp-route-id="@sub.Id" class="btn btn-sm btn-primary mr-2">Detail</a>
                                                    <a asp-area="Admin" asp-controller="Category" asp-action="Update" asp-route-id="@sub.Id" class="btn btn-sm btn-warning ">Edit</a>
                                                    <a href="#" class="btn btn-sm btn-danger delete-category" data-id="@sub.Id">Remove</a>
                                                </td>
                                            </tr>
                                        }
                                    }


                                </tbody>
                            </table>
                        </div>


                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@section Script {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var deleteLinks = document.querySelectorAll(".delete-category");

            deleteLinks.forEach(function (link) {
                link.addEventListener("click", function (e) {
                    e.preventDefault();

                    var categoryId = link.getAttribute("data-id");

                    fetch(`/Admin/Category/SoftDelete/${categoryId}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        }
                    })
                        .then(function (response) {
                            if (response.ok) {
                                link.closest("tr").remove();
                            } else {
                                console.error("Failed to delete category!");
                            }
                        })
                        .catch(function (error) {
                            console.error("Error:", error);
                            alert("An error occurred while deleting category!");
                        });
                });
            });
        });
    </script>
}